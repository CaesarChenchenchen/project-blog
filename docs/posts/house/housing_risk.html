<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tianxiao">
<meta name="dcterms.date" content="2023-10-31">

<title>Working Sample - Housing Subsidy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Working Sample</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/CrumpLab/quartoCourseBlog" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MattCrumpLab" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Housing Subsidy</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">real estate</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tianxiao </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 31, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The Department of Housing and Community Development (HCD) in Emil City is launching a home repair tax credit program, and they want to reach out to those who are most likely to take this credit at a low cost. When reaching out randomly, only 11% of the homeowners take this credit and the unsuccessful reach out also wastes a large amount of money.</p>
<p>In order to make the most use of the housing subsidy and create a satisfying benefit, I will build a logistic regression model to predict under given features whether a homeowner will take the credit or not.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">10000000</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotROC)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot) </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="housing_risk_cache/html/load_data_e6ad8c24bae54e95ad78602537af41e4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>palette5 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>,<span class="st">"#2a9d8f"</span>,<span class="st">"#e9c46a"</span>,<span class="st">'#f4a261'</span>,<span class="st">"#e76f51"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>palette4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>,<span class="st">"#2a9d8f"</span>,<span class="st">"#e9c46a"</span>,<span class="st">"#e76f51"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>palette2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>,<span class="st">"#2a9d8f"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>churn <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'/Users/mr.smile/Desktop/UPENN/FALL23/MUSA508/musa_5080_2023-main/Housing Subsidy/churnBounce.csv'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>house_sub <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'/Users/mr.smile/Desktop/UPENN/FALL23/MUSA508/musa_5080_2023-main/Housing Subsidy/housingSubsidy.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-visualization" class="level1">
<h1>Data Visualization</h1>
<p>Firstly, we want to figure out if there’s significantly feature difference in the groups whether they entered the program, which is useful and effective to determine the potential correlation between different variables and choices. The bar plot showing the median value of the feature, which represent the average situation, doesn’t tell much difference in whether enter the program. Besides, we can find that the group entering the program has a slightly higher median age and lower spend on repairs than the group not entering the program.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>house_sub <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(y,age, spent_on_repairs, cons.price.idx, cons.conf.idx) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(Variable, value, <span class="sc">-</span>y) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(y, value, <span class="at">fill=</span>y)) <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"median"</span>) <span class="sc">+</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette2) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Churn"</span>, <span class="at">y=</span><span class="st">"Value"</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">"Feature associations with the likelihood of entering the program"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="st">"(continous outcomes)"</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/median_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When it comes to the density plot of the features above, we can find two groups have apparent differences in the distribution. The group entering the program has a relatively lower distribution in the age from 30 to 50 years. As for the spend on repairs, we can clearly find that the group entering the program has an obviously lower distribution in the higher spend interval. When we focus on the economic background of the decision, we can find that the lower confidence index, which represent the relatively low consumption desire, have less influence on the group entering the program. Meanwhile, the higher consumer price index has more association with the rejection to enter the program.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>house_sub <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(y,age, spent_on_repairs, cons.price.idx, cons.conf.idx) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(Variable, value, <span class="sc">-</span>y) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="fu">aes</span>(value, <span class="at">color=</span>y), <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette2) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Feature distributions enter vs. no enter"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"(continous outcomes)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/density_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When we look at the count plot for different features related to whether entering the program, we can find that, in general, the group not entering the program has more members than that entering the program. In the job feature, we can find that the gap in some field is more extreme like administor, blue-collar, and technican.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>house_sub <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(y, marital,job,taxLien,poutcome) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(Variable, value, <span class="sc">-</span>y) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(Variable, value, y) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(., <span class="fu">aes</span>(value, n, <span class="at">fill =</span> y)) <span class="sc">+</span>   </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(<span class="sc">~</span>Variable, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette2) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Click"</span>, <span class="at">y=</span><span class="st">"Value"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">title =</span> <span class="st">"Feature associations with the likelihood of entering"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="st">"Categorical features"</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/count_plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="data-modeling" class="level1">
<h1>Data Modeling</h1>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h2>
<p>From the initial data visualization, we could hardly figure out the significantly difference between two different groups. Therefore, it’s essential to engineering the feature to improve further model performance. As for the education, jobs and pdays, which both have many categories, I re-categorize these feature into fewer categories. What’s more, I standardize the cpi and cci indicator to improve the interpretablity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>house_sub<span class="sc">$</span>cons.price.idx_s <span class="ot">&lt;-</span> <span class="fu">scale</span>(house_sub<span class="sc">$</span>cons.price.idx)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>house_sub<span class="sc">$</span>cons.conf.idx_s <span class="ot">&lt;-</span> <span class="fu">scale</span>(house_sub<span class="sc">$</span>cons.conf.idx)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>house_sub<span class="sc">$</span>poutcome_new <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(house_sub<span class="sc">$</span>poutcome <span class="sc">==</span> <span class="st">"success"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>house_sub <span class="ot">&lt;-</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  house_sub <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(education,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">education_new =</span> <span class="fu">case_when</span>(education <span class="sc">==</span> <span class="st">"basic.4y"</span> <span class="sc">~</span> <span class="st">"medium"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                               education <span class="sc">==</span> <span class="st">"basic.6y"</span> <span class="sc">~</span> <span class="st">"medium"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                               education <span class="sc">==</span> <span class="st">"basic.9y"</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                               education <span class="sc">==</span> <span class="st">"high.school"</span> <span class="sc">~</span> <span class="st">"high"</span>, </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                               education <span class="sc">==</span> <span class="st">"professional.course"</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                               education <span class="sc">==</span> <span class="st">"university.degree"</span> <span class="sc">~</span> <span class="st">"very high"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                               education <span class="sc">==</span> <span class="st">"illiterate"</span>  <span class="sc">~</span> <span class="st">"low"</span>, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                               education <span class="sc">==</span> <span class="st">"unknown"</span> <span class="sc">~</span> <span class="st">"low"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(job,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">job_new =</span> <span class="fu">case_when</span>(job <span class="sc">==</span> <span class="st">"retired"</span> <span class="sc">~</span> <span class="st">"low income"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"unemployed"</span> <span class="sc">~</span> <span class="st">"low income"</span>, </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span><span class="st">"unknown"</span> <span class="sc">~</span> <span class="st">"low income"</span>, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"student"</span> <span class="sc">~</span> <span class="st">"low income"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"housemaid"</span> <span class="sc">~</span> <span class="st">"medium income"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"blue-collar"</span> <span class="sc">~</span> <span class="st">"medium income"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"services"</span> <span class="sc">~</span> <span class="st">"medium income"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"technician"</span> <span class="sc">~</span> <span class="st">"high income"</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span>  <span class="st">"management"</span> <span class="sc">~</span> <span class="st">"high income"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"admin."</span> <span class="sc">~</span> <span class="st">"high income"</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"entrepreneur"</span> <span class="sc">~</span> <span class="st">"very high income"</span>, </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                         job <span class="sc">==</span> <span class="st">"self-employed"</span> <span class="sc">~</span> <span class="st">"medium income"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(pdays,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">pdays_new =</span> <span class="fu">case_when</span>(pdays <span class="sc">==</span> <span class="st">"0"</span>  <span class="sc">~</span> <span class="st">"0-6"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"1"</span> <span class="sc">~</span> <span class="st">"0-6"</span>, </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"2"</span> <span class="sc">~</span> <span class="st">"0-6"</span>, </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"3"</span> <span class="sc">~</span> <span class="st">"0-6"</span>, </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"4"</span> <span class="sc">~</span> <span class="st">"0-6"</span>, </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"5"</span> <span class="sc">~</span> <span class="st">"0-6"</span>, </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"6"</span> <span class="sc">~</span> <span class="st">"0-6"</span>, </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"7"</span> <span class="sc">~</span> <span class="st">"7-15"</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"9"</span>  <span class="sc">~</span> <span class="st">"7-15"</span>,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"10"</span>  <span class="sc">~</span> <span class="st">"7-15"</span>, </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"11"</span>  <span class="sc">~</span> <span class="st">"7-15"</span>, </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"12"</span>  <span class="sc">~</span> <span class="st">"7-15"</span>, </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"13"</span>  <span class="sc">~</span> <span class="st">"7-15"</span>, </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"14"</span>  <span class="sc">~</span> <span class="st">"7-15"</span>, </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"15"</span>  <span class="sc">~</span> <span class="st">"7-15"</span>, </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"17"</span> <span class="sc">~</span> <span class="st">"16-21"</span>, </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"18"</span> <span class="sc">~</span> <span class="st">"16-21"</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"19"</span> <span class="sc">~</span> <span class="st">"16-21"</span>, </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"21"</span><span class="sc">~</span> <span class="st">"16-21"</span>, </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"16"</span> <span class="sc">~</span> <span class="st">"16-21"</span>,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                           pdays <span class="sc">==</span> <span class="st">"999"</span> <span class="sc">~</span> <span class="st">"unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="training-and-test-split" class="level2">
<h2 class="anchored" data-anchor-id="training-and-test-split">Training and Test split</h2>
<p>After feature engineering, I split the dataset into training and test one with 65/35 for further data modeling. To compare the performance of new feature, I test the performance of both model using the raw features in the dataset and model with variables after feature engineering and selection.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(house_sub<span class="sc">$</span>y, <span class="at">p =</span> .<span class="dv">65</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">list =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>houseTrain <span class="ot">&lt;-</span> house_sub[ trainIndex,]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>houseTest  <span class="ot">&lt;-</span> house_sub[<span class="sc">-</span>trainIndex,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3426</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tempModel <span class="ot">&lt;-</span> <span class="fu">glm</span>(y_numeric <span class="sc">~</span> .,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>houseTrain <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X,<span class="sc">-</span> y,<span class="sc">-</span>cons.price.idx_s,<span class="sc">-</span>cons.conf.idx_s,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">-</span>poutcome_new,<span class="sc">-</span>education_new,<span class="sc">-</span>job_new,<span class="sc">-</span>pdays_new),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family=</span><span class="st">"binomial"</span> (<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>testProbs_raw <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Outcome =</span> <span class="fu">as.factor</span>(houseTest<span class="sc">$</span>y_numeric),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Probs =</span> <span class="fu">predict</span>(tempModel, houseTest, <span class="at">type=</span> <span class="st">"response"</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tempModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y_numeric ~ ., family = binomial(link = "logit"), 
    data = houseTrain %&gt;% dplyr::select(-X, -y, -cons.price.idx_s, 
        -cons.conf.idx_s, -poutcome_new, -education_new, -job_new, 
        -pdays_new))

Coefficients:
                                 Estimate   Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -193.7565741  127.7984723  -1.516 0.129491    
age                             0.0142384    0.0086150   1.653 0.098383 .  
jobblue-collar                 -0.3467856    0.2861796  -1.212 0.225598    
jobentrepreneur                -0.5024294    0.4766389  -1.054 0.291833    
jobhousemaid                    0.0665795    0.4920445   0.135 0.892365    
jobmanagement                  -0.7155597    0.3195953  -2.239 0.025159 *  
jobretired                     -0.2185553    0.3899311  -0.560 0.575140    
jobself-employed               -0.5748698    0.4292805  -1.339 0.180523    
jobservices                    -0.1561030    0.3018183  -0.517 0.605011    
jobstudent                     -0.2972152    0.4586449  -0.648 0.516966    
jobtechnician                  -0.0035192    0.2416566  -0.015 0.988381    
jobunemployed                   0.0113993    0.4777049   0.024 0.980962    
jobunknown                     -0.5130227    0.9233155  -0.556 0.578463    
maritalmarried                  0.2925676    0.2692011   1.087 0.277125    
maritalsingle                   0.3443418    0.3029167   1.137 0.255641    
maritalunknown                -13.5484129  471.5800915  -0.029 0.977080    
educationbasic.6y               0.6243513    0.4421978   1.412 0.157971    
educationbasic.9y               0.5959060    0.3789407   1.573 0.115821    
educationhigh.school            0.3131519    0.3624309   0.864 0.387570    
educationilliterate           -13.9561322 1455.3976605  -0.010 0.992349    
educationprofessional.course    0.7154565    0.3860064   1.853 0.063813 .  
educationuniversity.degree      0.5123543    0.3606339   1.421 0.155403    
educationunknown                0.4708085    0.4488698   1.049 0.294235    
taxLienunknown                 -0.2659035    0.2390765  -1.112 0.266048    
taxLienyes                    -12.1771728 1455.3976575  -0.008 0.993324    
mortgageunknown                -0.0855127    0.5266982  -0.162 0.871025    
mortgageyes                    -0.1756021    0.1491228  -1.178 0.238969    
taxbill_in_phlyes              -0.1300561    0.1944329  -0.669 0.503559    
contacttelephone               -1.2536614    0.2968190  -4.224 0.000024 ***
monthaug                       -0.2163491    0.4481657  -0.483 0.629278    
monthdec                        0.0859451    0.7057282   0.122 0.903072    
monthjul                       -0.3073090    0.3860889  -0.796 0.426059    
monthjun                        0.1079818    0.4605025   0.234 0.814607    
monthmar                        1.9766138    0.5845507   3.381 0.000721 ***
monthmay                       -0.3445120    0.3152756  -1.093 0.274511    
monthnov                       -0.4261588    0.4417362  -0.965 0.334677    
monthoct                        0.0663095    0.5653704   0.117 0.906634    
monthsep                       -0.0829597    0.6405100  -0.130 0.896945    
day_of_weekmon                 -0.2995344    0.2303156  -1.301 0.193416    
day_of_weekthu                 -0.1912149    0.2302379  -0.831 0.406250    
day_of_weektue                 -0.0281146    0.2313850  -0.122 0.903290    
day_of_weekwed                  0.1470685    0.2313566   0.636 0.524986    
campaign                       -0.0416736    0.0399321  -1.044 0.296665    
pdays                          -0.0005937    0.0008399  -0.707 0.479624    
previous                        0.1455766    0.2025662   0.719 0.472349    
poutcomenonexistent             0.8170531    0.3436879   2.377 0.017439 *  
poutcomesuccess                 0.9577807    0.8320618   1.151 0.249694    
unemploy_rate                  -0.9715137    0.4823099  -2.014 0.043979 *  
cons.price.idx                  1.8120114    0.8407990   2.155 0.031153 *  
cons.conf.idx                   0.0716044    0.0291579   2.456 0.014059 *  
inflation_rate                 -0.1175052    0.4595617  -0.256 0.798190    
spent_on_repairs                0.0048006    0.0104447   0.460 0.645785    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1853.7  on 2678  degrees of freedom
Residual deviance: 1391.3  on 2627  degrees of freedom
AIC: 1495.3

Number of Fisher Scoring iterations: 14</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3426</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>newModel <span class="ot">&lt;-</span> <span class="fu">glm</span>(y_numeric <span class="sc">~</span> .,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>houseTrain <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X,<span class="sc">-</span>y,<span class="sc">-</span>poutcome,<span class="sc">-</span>education,<span class="sc">-</span>job,<span class="sc">-</span>pdays,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">-</span>age,<span class="sc">-</span>day_of_week,<span class="sc">-</span>mortgage,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">-</span>taxbill_in_phl,<span class="sc">-</span>taxLien,<span class="sc">-</span>cons.price.idx,<span class="sc">-</span>cons.conf.idx</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                                  ),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family=</span><span class="st">"binomial"</span> (<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>testProbs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Outcome =</span> <span class="fu">as.factor</span>(houseTest<span class="sc">$</span>y_numeric),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Probs =</span> <span class="fu">predict</span>(newModel, houseTest, <span class="at">type=</span> <span class="st">"response"</span>))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(newModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y_numeric ~ ., family = binomial(link = "logit"), 
    data = houseTrain %&gt;% dplyr::select(-X, -y, -poutcome, -education, 
        -job, -pdays, -age, -day_of_week, -mortgage, -taxbill_in_phl, 
        -taxLien, -cons.price.idx, -cons.conf.idx))

Coefficients:
                            Estimate   Std. Error z value  Pr(&gt;|z|)    
(Intercept)             -10.67857738  51.47345814  -0.207  0.835652    
maritalmarried            0.20317012   0.26074138   0.779  0.435861    
maritalsingle             0.16384054   0.27576121   0.594  0.552419    
maritalunknown          -13.36499701 489.46686959  -0.027  0.978216    
contacttelephone         -1.18402612   0.29322289  -4.038 0.0000539 ***
monthaug                 -0.11214386   0.43900564  -0.255  0.798376    
monthdec                 -0.01079686   0.68405837  -0.016  0.987407    
monthjul                 -0.16884392   0.38091645  -0.443  0.657580    
monthjun                  0.23586597   0.44898467   0.525  0.599352    
monthmar                  1.98919097   0.57015394   3.489  0.000485 ***
monthmay                 -0.29875119   0.31041524  -0.962  0.335836    
monthnov                 -0.41254124   0.43469535  -0.949  0.342603    
monthoct                  0.08919060   0.56004384   0.159  0.873467    
monthsep                 -0.10168068   0.63457639  -0.160  0.872697    
campaign                 -0.04376002   0.03947379  -1.109  0.267610    
previous                 -0.23618124   0.12772635  -1.849  0.064441 .  
unemploy_rate            -0.94197901   0.47550590  -1.981  0.047591 *  
inflation_rate            0.00838913   0.44677763   0.019  0.985019    
spent_on_repairs          0.00187749   0.01018300   0.184  0.853720    
cons.price.idx_s          0.99845258   0.47561524   2.099  0.035792 *  
cons.conf.idx_s           0.29797649   0.13027638   2.287  0.022180 *  
poutcome_new              0.66448756   0.84248458   0.789  0.430274    
education_newlow          0.00004037   0.33224923   0.000  0.999903    
education_newmedium      -0.19618783   0.24309957  -0.807  0.419651    
education_newvery high   -0.04539249   0.17050390  -0.266  0.790066    
job_newlow income        -0.16724034   0.24201361  -0.691  0.489542    
job_newmedium income     -0.24734626   0.18146896  -1.363  0.172875    
job_newvery high income  -0.40101631   0.46048223  -0.871  0.383830    
pdays_new16-21           -2.23883739   1.29870242  -1.724  0.084725 .  
pdays_new7-15            -0.15475105   0.62871179  -0.246  0.805574    
pdays_newunknown         -0.86195394   0.89420360  -0.964  0.335079    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1853.7  on 2678  degrees of freedom
Residual deviance: 1416.4  on 2648  degrees of freedom
AIC: 1478.4

Number of Fisher Scoring iterations: 14</code></pre>
</div>
</div>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model Evaluation</h2>
<section id="distribution-of-predicted-probabilities" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-predicted-probabilities">Distribution of Predicted Probabilities</h3>
<p>When we look at the density plot of the predicted probabilities by observed outcome by different models, we can find that the distribution of these two model has little difference, while the model with new feature have more concentration and higher density in the prediction for not entering the program.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(testProbs, <span class="fu">aes</span>(<span class="at">x =</span> Probs, <span class="at">fill =</span> <span class="fu">as.factor</span>(Outcome))) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Outcome <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette2) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Enter"</span>, <span class="at">y =</span> <span class="st">"Density of probabilities"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Distribution of predicted probabilities by observed outcome(new)"</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/plot_testProbs_new-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(testProbs_raw, <span class="fu">aes</span>(<span class="at">x =</span> Probs, <span class="at">fill =</span> <span class="fu">as.factor</span>(Outcome))) <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Outcome <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> palette2) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Enter"</span>, <span class="at">y =</span> <span class="st">"Density of probabilities"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Distribution of predicted probabilities by observed outcome(raw)"</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/plot_testProbs_old-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="threshold-setting-and-analysis" class="level3">
<h3 class="anchored" data-anchor-id="threshold-setting-and-analysis">Threshold setting and analysis</h3>
<p>Based on the density, I set the probability’s threshold of 0.14 for determine whether the objective will enter the program. From the aspect of sensitivity, which represent the ability to correctly identify positive instances, the new model has better performance than the model with raw feature.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>testProbs <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  testProbs <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predOutcome  =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(testProbs<span class="sc">$</span>Probs <span class="sc">&gt;</span> <span class="fl">0.5</span> , <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(testProbs<span class="sc">$</span>predOutcome, testProbs<span class="sc">$</span>Outcome, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1256  123
         1   27   34
                                              
               Accuracy : 0.8958              
                 95% CI : (0.8789, 0.9111)    
    No Information Rate : 0.891               
    P-Value [Acc &gt; NIR] : 0.294               
                                              
                  Kappa : 0.2672              
                                              
 Mcnemar's Test P-Value : 0.000000000000008716
                                              
            Sensitivity : 0.21656             
            Specificity : 0.97896             
         Pos Pred Value : 0.55738             
         Neg Pred Value : 0.91080             
             Prevalence : 0.10903             
         Detection Rate : 0.02361             
   Detection Prevalence : 0.04236             
      Balanced Accuracy : 0.59776             
                                              
       'Positive' Class : 1                   
                                              </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>testProbs_raw <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  testProbs_raw <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predOutcome  =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(testProbs_raw<span class="sc">$</span>Probs <span class="sc">&gt;</span> <span class="fl">0.5</span> , <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(testProbs_raw<span class="sc">$</span>predOutcome, testProbs_raw<span class="sc">$</span>Outcome, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1239  113
         1   44   44
                                          
               Accuracy : 0.891           
                 95% CI : (0.8737, 0.9066)
    No Information Rate : 0.891           
    P-Value [Acc &gt; NIR] : 0.5212          
                                          
                  Kappa : 0.3047          
                                          
 Mcnemar's Test P-Value : 0.00000005731   
                                          
            Sensitivity : 0.28025         
            Specificity : 0.96571         
         Pos Pred Value : 0.50000         
         Neg Pred Value : 0.91642         
             Prevalence : 0.10903         
         Detection Rate : 0.03056         
   Detection Prevalence : 0.06111         
      Balanced Accuracy : 0.62298         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
</section>
<section id="roc-curve-auc-score" class="level3">
<h3 class="anchored" data-anchor-id="roc-curve-auc-score">ROC Curve &amp; AUC score</h3>
<p>To see the performance of two models more directly, I check the ROC(Receiver Operating Characteristic) curve, which visualize the performance of binary classification model. The curve that is “above” the y=x line shows the good performance of model. What’s more, I use the AUC (area under curve) score to measure the behavior, with higher score represent better ability to distinguish between the features. And the model with new feature having higher AUC score indicates the better interpretability for whether entering the program.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(testProbs, <span class="fu">aes</span>(<span class="at">d =</span> <span class="fu">as.numeric</span>(Outcome), <span class="at">m =</span> Probs)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_roc</span>(<span class="at">n.cuts =</span> <span class="dv">50</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">"#FE9900"</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_roc</span>(<span class="at">theme =</span> theme_grey) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">'grey'</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ROC Curve - clickModel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/roc_curve-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(testProbs<span class="sc">$</span>Outcome, testProbs<span class="sc">$</span>Probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.7687</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(testProbs_raw<span class="sc">$</span>Outcome, testProbs_raw<span class="sc">$</span>Probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.7517</code></pre>
</div>
</div>
</section>
</section>
<section id="cross-validation-fitness" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation-fitness">Cross Validation &amp; Fitness</h2>
<p>To assess the performance and generalization ability of two models and identify the issue of over-fitting due to randomness of train and test data splitting, I use cross validation to compare and select the final model. Comparing the results of two models, we can find that the the new model in general has better performance due to higher ROC score and sensitivity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">100</span>, <span class="at">classProbs=</span><span class="cn">TRUE</span>, <span class="at">summaryFunction=</span>twoClassSummary)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>cvFit <span class="ot">&lt;-</span> <span class="fu">train</span>(y <span class="sc">~</span> .,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>house_sub <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X,<span class="sc">-</span>y_numeric,<span class="sc">-</span>poutcome,<span class="sc">-</span>education,<span class="sc">-</span>job,<span class="sc">-</span>pdays,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">-</span>age,<span class="sc">-</span>day_of_week,<span class="sc">-</span>mortgage,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">-</span>taxbill_in_phl,<span class="sc">-</span>taxLien,<span class="sc">-</span>cons.price.idx,<span class="sc">-</span>cons.conf.idx), </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">"glm"</span>, <span class="at">family=</span><span class="st">"binomial"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">metric=</span><span class="st">"ROC"</span>, <span class="at">trControl =</span> ctrl)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>cvFit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized Linear Model 

4119 samples
  14 predictor
   2 classes: 'no', 'yes' 

No pre-processing
Resampling: Cross-Validated (100 fold) 
Summary of sample sizes: 4078, 4078, 4077, 4077, 4079, 4079, ... 
Resampling results:

  ROC        Sens       Spec 
  0.7729003  0.9825676  0.209</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cvFit_raw <span class="ot">&lt;-</span> <span class="fu">train</span>(y <span class="sc">~</span> .,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>house_sub <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X,<span class="sc">-</span> y_numeric,<span class="sc">-</span>cons.price.idx_s,<span class="sc">-</span>cons.conf.idx_s,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">-</span>poutcome_new,<span class="sc">-</span>education_new,<span class="sc">-</span>job_new,<span class="sc">-</span>pdays_new), </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">"glm"</span>, <span class="at">family=</span><span class="st">"binomial"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">metric=</span><span class="st">"ROC"</span>, <span class="at">trControl =</span> ctrl)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>cvFit_raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized Linear Model 

4119 samples
  19 predictor
   2 classes: 'no', 'yes' 

No pre-processing
Resampling: Cross-Validated (100 fold) 
Summary of sample sizes: 4078, 4078, 4077, 4078, 4077, 4078, ... 
Resampling results:

  ROC       Sens       Spec  
  0.762658  0.9811562  0.2185</code></pre>
</div>
</div>
<p>To check the goodness of fitting metrics more clearly, I visualize the result of 100 times cross validation to see the generalization and stability of the model when confronting different data. From the histogram of ROC score, we can find that the new model has distribution more like normal distribution compared the the raw model, and the situation shows that the new model is relatively more stable across different subsets of the data. What’s more, when we focus on the distribution of sensitivity, the new model has more density on the higher sensitivity score, which shows that the new model has better ability to correctly identify positive instances.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(cvFit<span class="sc">$</span>resample, <span class="sc">-</span>Resample) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(metric, value) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">gather</span>(cvFit<span class="sc">$</span>results[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], metric, mean)) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value)) <span class="sc">+</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">35</span>, <span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>metric) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> mean), <span class="at">colour =</span> <span class="st">"#e76f51"</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Goodness of Fit"</span>, <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">title=</span><span class="st">"CV Goodness of Fit Metrics(new)"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Across-fold mean reprented as dotted lines"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/goodness_metrics_new-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(cvFit_raw<span class="sc">$</span>resample, <span class="sc">-</span>Resample) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(metric, value) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">gather</span>(cvFit<span class="sc">$</span>results[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], metric, mean)) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value)) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">35</span>, <span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>metric) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> mean), <span class="at">colour =</span> <span class="st">"#e76f51"</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Goodness of Fit"</span>, <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">title=</span><span class="st">"CV Goodness of Fit Metrics(old)"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Across-fold mean reprented as dotted lines"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/goodness_metrics_old-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="cost-benefit-calculation" class="level1">
<h1>Cost-Benefit Calculation</h1>
<section id="situation-definition" class="level2">
<h2 class="anchored" data-anchor-id="situation-definition">Situation Definition</h2>
<p>To use the model to help calculate the benefits under the prediction of model, we need to set the benefits of different combinations of predicted and actual situation first. Our approach will be to use the confusion matrix from testProbs. Below the cost/benefit for each outcome in our confusion matrix is calculated, like so:</p>
<p>True Negative: $0 True Positive: (-$2850 - $5000 + $10000 + $56000)*0.25*Count - $2850*0.75<em>Count False Negative: -$2850</em>Count False Positive: $0</p>
</section>
<section id="cost-benefit-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cost-benefit-analysis">Cost-Benefit Analysis</h2>
<p>From the result of cost/benefit table, we can find that the main benefit comes from True-positive situation, which represent we correctly predict that the homeowner will enter the program. And the main cost comes from False-positive, where we would put into money for marketing source and the homeowners will not enter.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cost_benefit_table <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>   testProbs <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(predOutcome, Outcome) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">True_Negative =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">0</span>]),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">True_Positive =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">1</span>]),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">False_Negative =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">1</span>]),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">False_Positive =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">0</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">gather</span>(Variable, Count) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">Revenue =</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"True_Negative"</span>,<span class="dv">0</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"True_Positive"</span>,((<span class="sc">-</span><span class="dv">2850-5000</span><span class="sc">+</span><span class="dv">10000</span><span class="sc">+</span><span class="dv">56000</span>)<span class="sc">*</span>(Count<span class="sc">*</span><span class="fl">0.25</span>)<span class="sc">+</span>(<span class="sc">-</span><span class="dv">2850</span><span class="sc">*</span>Count<span class="sc">*</span><span class="fl">0.75</span>)),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"False_Negative"</span>, <span class="dv">0</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"False_Positive"</span>, <span class="sc">-</span><span class="dv">2850</span> <span class="sc">*</span> Count, <span class="dv">0</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">data.frame</span>(<span class="at">Description =</span> <span class="fu">c</span>(</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"We correctly predicted no enter"</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">"We correctly predicted enter"</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">"We predicted no enter and homeowner want to enter"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"We predicted homeowner will enter and homeowner did not enter"</span>)))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cost_benefit_table,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Cost/Benefit Table"</span>) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Cost/Benefit Table</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Revenue</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">True_Negative</td>
<td style="text-align: right;">1256</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">We correctly predicted no enter</td>
</tr>
<tr class="even">
<td style="text-align: left;">True_Positive</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">421600</td>
<td style="text-align: left;">We correctly predicted enter</td>
</tr>
<tr class="odd">
<td style="text-align: left;">False_Negative</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">We predicted no enter and homeowner want to enter</td>
</tr>
<tr class="even">
<td style="text-align: left;">False_Positive</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">-76950</td>
<td style="text-align: left;">We predicted homeowner will enter and homeowner did not enter</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>iterateThresholds <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> .<span class="dv">01</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  all_prediction <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (x <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  this_prediction <span class="ot">&lt;-</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      testProbs <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">predOutcome =</span> <span class="fu">ifelse</span>(Probs <span class="sc">&gt;</span> x, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(predOutcome, Outcome) <span class="sc">%&gt;%</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">True_Negative =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">0</span>]),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">True_Positive =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">1</span>]),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">False_Negative =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">1</span>]),</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">False_Positive =</span> <span class="fu">sum</span>(n[predOutcome<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Outcome<span class="sc">==</span><span class="dv">0</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">gather</span>(Variable, Count) <span class="sc">%&gt;%</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">Revenue =</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"True_Negative"</span>, <span class="dv">0</span>,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"True_Positive"</span>,((<span class="sc">-</span><span class="dv">2850-5000</span><span class="sc">+</span><span class="dv">10000</span><span class="sc">+</span><span class="dv">56000</span>)<span class="sc">*</span>(Count<span class="sc">*</span><span class="fl">0.25</span>)<span class="sc">+</span>(<span class="sc">-</span><span class="dv">2850</span><span class="sc">*</span>Count<span class="sc">*</span><span class="fl">0.75</span>)),</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"False_Negative"</span>, <span class="dv">0</span>,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"False_Positive"</span>, <span class="sc">-</span><span class="dv">2850</span> <span class="sc">*</span> Count, <span class="dv">0</span>)))),</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">Threshold =</span> x)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  all_prediction <span class="ot">&lt;-</span> <span class="fu">rbind</span>(all_prediction, this_prediction)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> .<span class="dv">01</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(all_prediction)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the cost/benefit analysis, we want to increase the true-positive rate and decrease the False-Positive rate to increase the total benefit for the model.Therefore, we need to find the different threshold’s influence on this two indicators. We can find that with the increase of threshold, the True-positive and False Positive will both decrease.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>whichThreshold <span class="ot">&lt;-</span> <span class="fu">iterateThresholds</span>(test_Probs1)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>whichThreshold <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(.,<span class="fu">aes</span>(Threshold, Count, <span class="at">colour =</span> Variable)) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> palette4) <span class="sc">+</span>    </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Confusion Metric Outcome by Threshold"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Legend"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/confusion matrix plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, it’s hard to get the maximium of benefits easily. So we plot the line of benefits with the increasing threshold. We can find the benefit will reach the max when the threshold is set as 0.14 properly.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>whichThreshold <span class="ot">&lt;-</span> <span class="fu">iterateThresholds</span>(testProbs2)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>whichThreshold_revenue <span class="ot">&lt;-</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>whichThreshold <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Threshold) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Revenue =</span> <span class="fu">sum</span>(Revenue))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(whichThreshold_revenue)<span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Threshold, <span class="at">y =</span> Revenue))<span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span>  <span class="fu">pull</span>(<span class="fu">arrange</span>(whichThreshold_revenue, <span class="sc">-</span>Revenue)[<span class="dv">1</span>,<span class="dv">1</span>]))<span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model Revenues By Threshold For Test Sample"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Vertical Line Denotes Optimal Threshold"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/revenue_model-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, if we use the counts of credits, which represents the number of homeowners can get the credit to enter the program, to measure the performance of different threshold, we can find that the count of credit will continously increase with the increase of threshold until the threshold comes to 0.8.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>whichThreshold_credit <span class="ot">&lt;-</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>whichThreshold <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">credit =</span>  <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"True_Positive"</span>, (Count <span class="sc">*</span> <span class="fl">0.25</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(Variable <span class="sc">==</span> <span class="st">"False_Negative"</span>, Count, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Threshold) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Credit =</span> <span class="fu">sum</span>(credit))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(whichThreshold_credit)<span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Threshold, <span class="at">y =</span> Credit, <span class="at">colour =</span> <span class="st">"#FE9900"</span>))<span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span>  <span class="fu">pull</span>(<span class="fu">arrange</span>(whichThreshold_credit, <span class="sc">-</span>Credit)[<span class="dv">1</span>,<span class="dv">1</span>]))<span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Count of Credits By Threshold For Test Sample"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Vertical Line Denotes Optimal Threshold"</span>)<span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"None"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="housing_risk_files/figure-html/credit_model-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>if we compare the revenue and credit number of the optimal benefits’ threshold and 0.5 threshold, we can find that despite the benefit will reach max with 0.22 threshold for the model, the model with serve less credit compared to 0.5 threshold.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>threshold_table <span class="ot">&lt;-</span> <span class="fu">merge</span>(whichThreshold_revenue, whichThreshold_credit, <span class="at">by =</span> <span class="st">"Threshold"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>final_table <span class="ot">&lt;-</span> threshold_table <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">slice</span>(<span class="dv">22</span>, <span class="dv">50</span>) </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(final_table, <span class="at">caption =</span> <span class="st">"Total Revenue and Total Count of Credits for Optimal Threshold and 0.5 Threshold"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Total Revenue and Total Count of Credits for Optimal Threshold and 0.5 Threshold</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Threshold</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Revenue</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Credit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">609800</td>
<td style="text-align: right;">101.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">344650</td>
<td style="text-align: right;">131.5</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In general, I would not recommend this model be put into production. For one thing, the model could have potential bias due to the feature used in the model. The reclassification and consideration of martial, job, and education would lead to potential bias to the vulnerable group in the model production. What’s more, the model show the weakness in the reliability due to model’s low likelihood. This situation may come from limited features in the dataset. If the model could consider more comprehensive factors that influence the credit of homeowner, the model could have better likelihood performance.</p>
<p>Therefore, to improve the performance of model, we can add more variables in the model to increase the comprehensive consideration. For another, we could also think about the features which could lead to bias more consciously. To ensure that the marketing materials resulted in a better response rate, we could based on the actual situation to switch the threshold of model promptly based on the period feedback from the market.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>