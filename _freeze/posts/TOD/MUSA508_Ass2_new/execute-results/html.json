{
  "hash": "15506964abc127c86dc19556bd289853",
  "result": {
    "markdown": "---\ntitle: \"TOD Development -- Washington DC for example\"\nauthor: \"Tianxiao Chen\"\ndate: \"2023-09-10\"\ncategories: [transit, planning, code, analysis]\nimage: \"transit.jpeg\"\noutput:\n  html_document:\n    code-fold: true\n    code-summary: \"Show the code\"\n---\n\n\n# Data wrangling\n\nWashington DC has a mature rail transit system, which provides the city with highly possibility of TOD development. Therefore, we take Washington DC as our analysis site to explore the current situation of region surrounding station and if DC has potential for TOD development in the future. \n\n\n\n\n\n\n\n\n## Social and Economic Dataset\nTo make further analysis, we select some of the variables, including population, median rent, median household income and etc, and use the ACS-5 data in 2009 and 2019 as our raw data source. Besides basic variable, we create new varialbes like percentage of Bachelors or more and percentage of white to have more comprehensive analysis.\n\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/load_variables_574564c328de1378d6bc076a39bb9843'}\n\n```{.r .cell-code}\nacs_variable_list.2019 <- load_variables(2019, #year\n                                         \"acs5\", #five year ACS estimates\n                                         cache = TRUE)\n\nacs_variable_list.2009 <- load_variables(2009, #year\n                                         \"acs5\", #five year ACS estimates\n                                         cache = TRUE)\n```\n:::\n\n::: {.cell result='hide' hash='MUSA508_Ass2_new_cache/html/variables need to include_c8479b8d6bf9903417f80d139afb161e'}\n\n```{.r .cell-code}\ntracts19 <-  \n  get_acs(geography = \"tract\",\n          variables = c(\"B25026_001E\",\"B02001_002E\",\n                        \"B15001_050E\",\"B15001_009E\",\n                        \"B19013_001E\", \"B25058_001E\",\n                        \"B06012_002E\"), \n          year=2019, state=11,\n          geometry=TRUE) %>% \n  st_transform('ESRI:102728')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n:::\n\n::: {.cell result='hide' hash='MUSA508_Ass2_new_cache/html/load 2019 tract data_4452869626f5e9123f5002a54f884b1e'}\n\n```{.r .cell-code}\ntracts19 <- \n  tracts19 %>%\n  dplyr::select( -NAME, -moe) %>%\n  spread(key = variable, value = estimate) %>%\n  rename(TotalPop = B25026_001, \n         Whites = B02001_002,\n         FemaleBachelors = B15001_050, \n         MaleBachelors = B15001_009,\n         MedHHInc = B19013_001, \n         MedRent = B25058_001,\n         TotalPoverty = B06012_002)\n\ntracts19 <- \n  tracts19 %>%\n  mutate(pctWhite = ifelse(TotalPop > 0, Whites / TotalPop, 0),\n         pctBachelors = ifelse(TotalPop > 0, ((FemaleBachelors + MaleBachelors) / TotalPop), 0),\n         pctPoverty = ifelse(TotalPop > 0, TotalPoverty / TotalPop, 0),\n         year = \"2019\") %>%\n  dplyr::select(-Whites,-FemaleBachelors,-MaleBachelors,-TotalPoverty)\n```\n:::\n\n::: {.cell result='hide' hash='MUSA508_Ass2_new_cache/html/load 2009 tract data_6ad1271892a114d7b0cf5e185917027e'}\n\n```{.r .cell-code}\ntracts09 <- \n  get_acs(geography = \"tract\", \n          variables = c(\"B25026_001E\",\"B02001_002E\",\n                        \"B15001_050E\",\"B15001_009E\",\n                        \"B19013_001E\",\"B25058_001E\",\n                        \"B06012_002E\"), \n          year=2009, state=11, \n          geometry=TRUE, output=\"wide\") %>%\n  st_transform('ESRI:102728') %>%\n  rename(TotalPop = B25026_001E, \n         Whites = B02001_002E,\n         FemaleBachelors = B15001_050E, \n         MaleBachelors = B15001_009E,\n         MedHHInc = B19013_001E, \n         MedRent = B25058_001E,\n         TotalPoverty = B06012_002E) %>%\n  dplyr::select(-NAME, -starts_with(\"B\")) %>%\n  mutate(pctWhite = ifelse(TotalPop > 0, Whites / TotalPop,0),\n         pctBachelors = ifelse(TotalPop > 0, ((FemaleBachelors + MaleBachelors) / TotalPop),0),\n         pctPoverty = ifelse(TotalPop > 0, TotalPoverty / TotalPop, 0),\n         year = \"2009\") %>%\n  dplyr::select(-Whites, -FemaleBachelors, -MaleBachelors, -TotalPoverty) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/combine tract dataset_fd301179e4cb870f59575883d5912fd3'}\n\n```{.r .cell-code}\nallTracts <- rbind(tracts19,tracts09)\n```\n:::\n\n\nTo understand if the station has indication to the public safety, we also collect crime dataset from DC gov website to join the existing social and economic dataset.\n\n\n::: {.cell result='hide' hash='MUSA508_Ass2_new_cache/html/crimedata_e373c0670869288654bb8e94891e9d69'}\n\n```{.r .cell-code}\ncrime19 <- st_read(\"https://maps2.dcgis.dc.gov/dcgis/rest/services/FEEDS/MPD/MapServer/1/query?outFields=*&where=1%3D1&f=geojson\") %>%\n  dplyr::select(OFFENSE, CENSUS_TRACT, OBJECTID) %>%\n  st_transform('ESRI:102728')  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `OGRGeoJSON' from data source \n  `https://maps2.dcgis.dc.gov/dcgis/rest/services/FEEDS/MPD/MapServer/1/query?outFields=*&where=1%3D1&f=geojson' \n  using driver `GeoJSON'\nSimple feature collection with 33969 features and 23 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -77.11414 ymin: 38.81939 xmax: -76.91002 ymax: 38.9937\nGeodetic CRS:  WGS 84\n```\n:::\n\n```{.r .cell-code}\ncrime09 <- st_read(\"https://maps2.dcgis.dc.gov/dcgis/rest/services/FEEDS/MPD/MapServer/33/query?outFields=*&where=1%3D1&f=geojson\") %>%\n  dplyr::select(OFFENSE, CENSUS_TRACT, OBJECTID) %>%\n  st_transform('ESRI:102728') \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `OGRGeoJSON' from data source \n  `https://maps2.dcgis.dc.gov/dcgis/rest/services/FEEDS/MPD/MapServer/33/query?outFields=*&where=1%3D1&f=geojson' \n  using driver `GeoJSON'\nSimple feature collection with 31354 features and 23 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -77.11276 ymin: 38.81348 xmax: -76.91002 ymax: 38.99422\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/crime_data_09_19_214b580b2040f92ea039b3568d641ef6'}\n\n```{.r .cell-code}\ncrime_counts_by_tract_19 <- allTracts %>%\n  st_intersection(crime19) %>%\n  group_by(GEOID) %>%\n  summarise(crime_counts=n()) %>%\n  st_drop_geometry() %>%\n  mutate(year=\"2019\")\n\ncrime_counts_by_tract_09 <- allTracts %>%\n  st_intersection(crime09) %>%\n  group_by(GEOID) %>%\n  summarise(crime_counts=n()) %>%\n  st_drop_geometry() %>%\n  mutate(year=\"2009\")\n\ncrime_counts_all <- rbind(crime_counts_by_tract_09, crime_counts_by_tract_19)\nallTracts <- left_join(allTracts, crime_counts_all, by=c(\"GEOID\"=\"GEOID\", \"year\"=\"year\"))\n```\n:::\n\n\n## Station dataset\nDue to Washington DC has mature and widespread metro system, we select DC's metro station data, which is also from DC gov website, as our transportation element in the TOD analysis.\n\n::: {.cell result='hide' hash='MUSA508_Ass2_new_cache/html/load station data_47160d14fd5c414f8525e4bb0f05efa2'}\n\n```{.r .cell-code}\ndc_station <- st_read(\"https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Transportation_Rail_Bus_WebMercator/MapServer/52/query?where=1%3D1&outFields=*&outSR=4326&f=json\") %>%\n  dplyr::select(NAME,LINE) %>%\n  st_transform('ESRI:102728')  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `ESRIJSON' from data source \n  `https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Transportation_Rail_Bus_WebMercator/MapServer/52/query?where=1%3D1&outFields=*&outSR=4326&f=json' \n  using driver `ESRIJSON'\nSimple feature collection with 40 features and 13 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -77.085 ymin: 38.84567 xmax: -76.93526 ymax: 38.97609\nGeodetic CRS:  WGS 84\n```\n:::\n\n```{.r .cell-code}\ndc_line <- st_read('https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Transportation_Rail_Bus_WebMercator/MapServer/106/query?outFields=*&where=1%3D1&f=geojson') %>%\n  dplyr::select(NAME,GIS_ID)%>%\n  st_transform('ESRI:102728')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `OGRGeoJSON' from data source \n  `https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Transportation_Rail_Bus_WebMercator/MapServer/106/query?outFields=*&where=1%3D1&f=geojson' \n  using driver `GeoJSON'\nSimple feature collection with 6 features and 10 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: -77.08577 ymin: 38.83827 xmax: -76.91328 ymax: 38.97979\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n\nFrom the map of station and line distribution, we can find that the stations mainly locate in the north part of DC, diffusing from the center. The lines build a continous connection from the north-west to south-east, while having some connections from north to the central part of DC.\n\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/visualization station_8bab9160031ca27f383657859d650d06'}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = st_union(tracts19)) +\n  geom_sf(data = dc_station,\n          aes(color = LINE),\n          show.legend = 'Point',size=2) +\n  geom_sf(data = dc_line,\n          aes(color = GIS_ID),\n          show.legend = 'Line',size=1)\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/visualization station-1.png){width=672}\n:::\n\n```{.r .cell-code}\n  labs(title = 'Station stops',\n       subtitle = 'Washington DC',\n       caption = 'Figure 1,1')+\n  scale_color_manual(values = c(\"blue\",\"green\",\"orange\",\"red\",\"#C0C0C0\",\"yellow\"),name=\"Metro Line\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNULL\n```\n:::\n:::\n\n\n# Definition of TOD region\nTo explore the influence of TOD, we need to clarify the range of TOD region. First of all, we set 0.5 miles, 15 minutes walking distance, from station as the range in the influence of TOD. Secondly, we choose three different methods to define the range of tracts in TOD region, composed of the range in the 0.5 mile's buffer, the tracts which centroid point is in the 0.5 mile's buffer, and the tracts that have intersection with 0.5 mile's buffer.\n\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/station buffer dataset_9af49ce8b2e0d3fb59293fff2c2d1025'}\n\n```{.r .cell-code}\nstation_buffer<- rbind(\n  st_buffer(dc_station,2640) %>%\n    mutate(Legend = 'buffer')%>%\n    dplyr::select(Legend),\n  st_union(st_buffer(dc_station,2640))%>%\n    st_sf()%>%\n    mutate(Legend = 'Unioned Buffer')\n)\n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/station buffer range_557edf1d65f79dae1eed45bda46614b9'}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = station_buffer) +\n  geom_sf(data = dc_station,\n          show.legend = 'Point',size = 2) +\n  facet_wrap(~Legend) + \n  labs(title = 'Station 0.5 miles buffer',\n       caption = 'Figure 1.2')+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/station buffer range-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/get the union buffer dataset_1123f3fd35fc5e67e6c3bc2aca140c63'}\n\n```{.r .cell-code}\nbuffer <- filter(station_buffer, Legend=='Unioned Buffer')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclip <- st_intersection(buffer,tracts19) %>%\n  dplyr::select(TotalPop)%>%\n  mutate(inter_type = 'Clip')\n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/selection-2_258e48e84512577e90480153106ec692'}\n\n```{.r .cell-code}\nselection <- tracts19[buffer,]%>%\n  select(TotalPop)%>%\n  mutate(inter_type = 'Spatial Selection')\n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/selection-3_5f9e6224bcef46bb619a5d22fde055c2'}\n\n```{.r .cell-code}\nselect_centroid <- st_centroid(tracts19)[buffer,] %>%\n  st_drop_geometry() %>%\n  left_join(., dplyr::select(tracts19, GEOID), by = \"GEOID\") %>%\n  st_sf() %>%\n  dplyr::select(TotalPop) %>%\n  mutate(inter_type = \"Centroids\")\n```\n:::\n\n\nAfter the visualization of three different definition method, we can easily find that the third way includes much more tracts' area especially some large tracts and excessive inclusion due to irregular boundary shapes. Comparing the first and second method, despite the second method has the most precise boundry of TOD range, the unit of data is tract make such method have more problem in data representing.\n\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/selection visualize and compare_85a0b509a1e77934a1985e356d2658fb'}\n\n```{.r .cell-code}\nintersections <- rbind(clip, selection, select_centroid)\n\nggplot() +\n  geom_sf(data=intersections, aes(fill = TotalPop)) +\n  geom_sf(data=dc_station, show.legend = \"point\") +\n  scale_fill_viridis_c() +\n  facet_wrap(~inter_type) + \n  labs(title = '3 different TOD range selection methods comaparison',\n       caption = 'Figure 1.3')+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/selection visualize and compare-1.png){width=672}\n:::\n:::\n\n\nif we use the second method to define TOD area and use the tract, whose GEOID is not in the set of tracts in TOD area, we can find that large part of tracts get lost in the map. The situation results from the same dilemma as the third method to define TOD region. the tract information in such small area could not represent the whole tract, especially estimating the influence of TOD. As a result, we select the first approach as our way to define TOD region. \nHowever, we still need to acknowledge the limitation of less consideration of tract that in a close distance to TOD but have not direct intersection to 0.5 miles' buffer in the first method. \n\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/final selection of centroids_16c8267ad600224e20cdf87faceb6445'}\n\n```{.r .cell-code}\ntod_part <- st_intersection(buffer,allTracts)%>%\n  mutate(TOD = 'TOD')%>%\n  dplyr::select(-Legend)\n\nnon_tod_part <- allTracts %>%\n  filter(!(GEOID %in% tod_part$GEOID))%>%\n  mutate(TOD = 'Non_TOD')\n\nggplot() +\n  geom_sf(data = non_tod_part,aes(fill = TotalPop))+\n  geom_sf(data = tod_part,aes(fill = TotalPop))+\n  labs(title = 'Drawback of clip method to define TOD',\n       caption = 'Figure 1.4')+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/final selection of centroids-1.png){width=672}\n:::\n:::\n\n\n# TOD analysis\n## TOD dataset create\nBased on the selected defining method, we set TOD label for ACS-5 dataset. Considering the inflation, we make inflation adjustment on the median rent and median household income in the dataset for better comparison.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/TOD label set_19415aa08a308bddf32ca87123da3a62'}\n\n```{.r .cell-code}\nallTracts.group <- \n  rbind(\n    st_centroid(allTracts)[buffer,] %>%\n      st_drop_geometry() %>%\n      left_join(allTracts) %>%\n      st_sf() %>%\n      mutate(TOD = \"TOD\"),\n    st_centroid(allTracts)[buffer, op = st_disjoint] %>%\n      st_drop_geometry() %>%\n      left_join(allTracts) %>%\n      st_sf() %>%\n      mutate(TOD = \"Non-TOD\")) %>%\n  mutate(MedRent.inf = ifelse(year == \"2009\", MedRent * 1.19, MedRent))%>%\n  mutate(MedHHInc.inf = ifelse(year == \"2009\", MedHHInc *1.19, MedHHInc)) \n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/get tracrts centroid dataset_ebca023edaa8a2dfe424310c949759dc'}\n\n```{.r .cell-code}\ncentroid_all <- st_centroid(allTracts.group, of_largest_polygon = TRUE)\n```\n:::\n\nMeanwhile, we filter the part with 'TOD' label in dataset for further deeper analysis in the TOD region.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/area of TOD_ecd9f01aad8bc480cb9b35d79098254b'}\n\n```{.r .cell-code}\nTod_region <- allTracts.group %>%\n  select(TOD) %>%\n  filter(TOD ==\"TOD\") %>%\n  st_union() %>%\n  st_sf()\n```\n:::\n\n\n## Social and economic analysis based on TOD\nBefore discussing the impacts of railway station to surrounding tracts, we figure out the difference of TOD region between 2009 and 2019. We can find that the most tracts in 2019 kept the same as 2009, except few tracts was excluded due to tracts' re-split. Overall, the TOD region kept the same from 2009 to 2019. \n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/TOD space time compare_fbd516e226b83370e63f04ea4f607040'}\n\n```{.r .cell-code}\nggplot(allTracts.group)+\n  geom_sf(data = st_union(tracts19))+\n  geom_sf(aes(fill = TOD))+\n  scale_fill_manual(values = c(\"grey\", \"yellow\"))+\n  labs(title = \"TOD and Non-TOD Census Tracts in Washington DC\",\n       caption = \"Figure 2.1\")+\n  facet_wrap(~year)+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/TOD space time compare-1.png){width=672}\n:::\n:::\n\nFrom the map of population distribution, we can find that DC has more population in 2019 in general. Besides the north-west and south part, the north-east part had trend to become another populations agglomeration. However,there's not obvious difference in the population change in the TOD area.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/population change_785d78021a64be3faf7209170f052d9a'}\n\n```{.r .cell-code}\n#Total Population within the TOD & Non-TOD tracts from 2009 to 2019\nggplot(allTracts.group)+\n  geom_sf(data = st_union(tracts19))+\n  geom_sf(aes(fill=q5(TotalPop)))+\n  geom_sf(data = st_union(Tod_region), color = \"red\",fill=\"transparent\", size = 200)+\n  scale_fill_manual(values = palette5,\n                    labels= qBr(allTracts.group, \"TotalPop\"),\n                    name = \"Population\\n(Quintile Breaks)\")+\n    labs(title = \"Total Population by census tracts, 2009-2019\",\n         subtitle = \"Washington DC\",\n       caption = \"Figure 2.2\")+\n  facet_wrap(~year)+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/population change-1.png){width=672}\n:::\n:::\n\nWhen it comes to the median household income, we can easily find that the north-west part have a average higher income level, which kept the same situation from 2009 to 2019. Focusing on the TOD region, we can find that in the center part of TOD region had an apparent median household income increase comapred to the surrounding areas.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/median household income change_4f0dd410db9aeb3f22282ef49f7bc2ec'}\n\n```{.r .cell-code}\n#Median household income within the TOD & Non-TOD tracts from 2009 to 2019\nggplot(allTracts.group)+\n  geom_sf(data = st_union(tracts19))+\n  geom_sf(aes(fill=q5(MedHHInc.inf)))+\n  geom_sf(data = st_union(Tod_region), color = \"red\",fill=\"transparent\", size = 9)+\n  scale_fill_manual(values = palette5,\n                    labels= qBr(allTracts.group, \"MedHHInc.inf\"),\n                    name = \"Median Household Income($)\\n(Quintile Breaks)\\n(Inflation adjusted to 2019)\")+\n    labs(title = \"Median Household Income by census tracts, 2009-2019\",\n         subtitle = \"Washington DC\",\n       caption = \"Figure 2.3\")+\n  facet_wrap(~year)+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/median household income change-1.png){width=672}\n:::\n:::\n\nCompared to change in median household income, the high-education group (the group have the bachelors or higher degree) distribution had an interesting change in the decade. Compared to 2009, the high-education group gradually moved to the central part of DC from north-west part. Despite not much strong evidence showing the influence of TOD, the central part, which locates many transfer station, still had potential influence of gathering of people.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/education level change_77b13647bf27b72d5d4e1ed4f939209d'}\n\n```{.r .cell-code}\n#Percentage of bachelors within the TOD & Non-TOD tracts from 2009 to 2019\nggplot(allTracts.group)+\n  geom_sf(data = st_union(tracts19))+\n  geom_sf(aes(fill=q5(pctBachelors)))+\n  geom_sf(data = st_union(Tod_region), color = \"red\",fill=\"transparent\", size = 9)+\n  scale_fill_manual(values = palette5,\n                    labels= newqBr(allTracts.group, \"pctBachelors\"),\n                    name = \"Percentage of Bachelors\\n(Quintile Breaks)\")+\n    labs(title = \"Percentage of Bachelors by census tracts, 2009-2019\",\n         subtitle = \"Washington DC\",\n       caption = \"Figure 2.4\")+\n  facet_wrap(~year)+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/education level change-1.png){width=672}\n:::\n:::\n\nThe change in median rent price has a similar trend like change in median household income. In general, whole DC experienced a rent increase in the decade, with north part owning a higher median rent price. Also, the region in the influence of TOD tend to have a higehr price in 2019 comapred to 2009.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/median rent changev_4372915af0e4eb671d8c9bb0d57d64b3'}\n\n```{.r .cell-code}\n#Median Rent within the TOD & Non-TOD tracts from 2009 to 2019\nggplot(allTracts.group)+\n  geom_sf(data = st_union(tracts19))+\n  geom_sf(aes(fill=q5(MedRent.inf)))+\n  geom_sf(data = st_union(Tod_region), color = \"red\",fill=\"transparent\", size = 9)+\n  scale_fill_manual(values = palette5,\n                    labels= newqBr(allTracts.group, \"MedRent.inf\"),\n                    name = \"Median Rent($)\\n(Quintile Breaks)\\n(Inflation adjusted to 2019)\")+\n    labs(title = \"Median Rent by census tracts, 2009-2019\",\n         subtitle = \"Washington DC\",\n       caption = \"Figure 2.5\")+\n  facet_wrap(~year)+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/median rent changev-1.png){width=672}\n:::\n:::\n\nConcerning public safety, we can find that crime counts had a slight increase in the decade, concentrating in the central and east part of DC. As the trasfer station located in the central part before, we can assume that the TOD could also increase the crime possibility in the radius area. \n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/crime change_b97cc41137750a66db1604a88b0d712c'}\n\n```{.r .cell-code}\n#Crime counts within the TOD & Non-TOD tracts from 2009 to 2019\nggplot(allTracts.group)+\n  geom_sf(data = st_union(tracts19))+\n  geom_sf(aes(fill=q5(crime_counts)))+\n  geom_sf(data = st_union(Tod_region), color = \"red\",fill=\"transparent\", size = 9)+\n  scale_fill_manual(values = palette5,\n                    labels= newqBr(allTracts.group, \"crime_counts\"),\n                    name = \"Crime Counts\\n(Quintile Breaks)\")+\n    labs(title = \"Crime Counts by census tracts, 2009-2019\",\n         subtitle = \"Washington DC\",\n       caption = \"Figure 2.6\")+\n  facet_wrap(~year)+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/crime change-1.png){width=672}\n:::\n:::\n\n\n# Basic comparison in TOD and Non-TOD area\nBesides the brief summary and regional analysis from mapping, we create table to make more rigorous and data-driven analysis about the difference between TOD and non-TOD area.\nFrom the table and bar charts, when we focus on the change from 2009 to 2019, the household income, crime count, population and median rent both increased in TOD and Non-TOD region. Besides, percentage white decreased in Non-TOD region while percentage of poverty decrease in TOD region.\n\nConsidering the difference in TOD and Non-TOD region, we can find a huge switch between 2009 and 2019. Compared to 2009, the TOD region in 2019 had faster crime numbers, household income, percentage of white, median rent price and population increase than Non-TOD region. Besides the percentage of poverty got lower in TOD region than that in Non-TOD, whose situation was reversed in 2009.\n\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/summary table_7942055997af9e4ff23bc4896e4a75af'}\n\n```{.r .cell-code}\nallTracts.Summary <- \n  st_drop_geometry(allTracts.group) %>%\n  group_by(year, TOD) %>%\n  summarize(Rent = mean(MedRent, na.rm = T),\n            Population = mean(TotalPop, na.rm = T),\n            Percent_White = mean(pctWhite, na.rm = T),\n            Percent_Bach = mean(pctBachelors, na.rm = T),\n            Percent_Poverty = mean(pctPoverty, na.rm = T),\n            HH_Income=mean(MedHHInc.inf, na.rm = T),\n            Crime_Counts=mean(crime_counts,na.rm = T))\n\nallTracts.Summary %>%\n  unite(year.TOD, year, TOD, sep = \": \", remove = T) %>%\n  gather(Variable, Value, -year.TOD) %>%\n  mutate(Value = round(Value, 2)) %>%\n  spread(year.TOD, Value) %>%\n  kable() %>%\n  kable_styling() %>%\n  footnote(general_title = \"\\n\",\n           general = \"Table 1\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:right;\"> 2009: Non-TOD </th>\n   <th style=\"text-align:right;\"> 2009: TOD </th>\n   <th style=\"text-align:right;\"> 2019: Non-TOD </th>\n   <th style=\"text-align:right;\"> 2019: TOD </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Crime_Counts </td>\n   <td style=\"text-align:right;\"> 274.56 </td>\n   <td style=\"text-align:right;\"> 356.71 </td>\n   <td style=\"text-align:right;\"> 278.70 </td>\n   <td style=\"text-align:right;\"> 450.92 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HH_Income </td>\n   <td style=\"text-align:right;\"> 73778.65 </td>\n   <td style=\"text-align:right;\"> 75620.41 </td>\n   <td style=\"text-align:right;\"> 86196.55 </td>\n   <td style=\"text-align:right;\"> 101401.36 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Percent_Bach </td>\n   <td style=\"text-align:right;\"> 0.02 </td>\n   <td style=\"text-align:right;\"> 0.04 </td>\n   <td style=\"text-align:right;\"> 0.02 </td>\n   <td style=\"text-align:right;\"> 0.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Percent_Poverty </td>\n   <td style=\"text-align:right;\"> 0.18 </td>\n   <td style=\"text-align:right;\"> 0.23 </td>\n   <td style=\"text-align:right;\"> 0.18 </td>\n   <td style=\"text-align:right;\"> 0.17 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Percent_White </td>\n   <td style=\"text-align:right;\"> 0.56 </td>\n   <td style=\"text-align:right;\"> 0.59 </td>\n   <td style=\"text-align:right;\"> 0.34 </td>\n   <td style=\"text-align:right;\"> 0.61 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Population </td>\n   <td style=\"text-align:right;\"> 2996.05 </td>\n   <td style=\"text-align:right;\"> 2869.95 </td>\n   <td style=\"text-align:right;\"> 3572.93 </td>\n   <td style=\"text-align:right;\"> 3767.50 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Rent </td>\n   <td style=\"text-align:right;\"> 910.39 </td>\n   <td style=\"text-align:right;\"> 968.29 </td>\n   <td style=\"text-align:right;\"> 1358.34 </td>\n   <td style=\"text-align:right;\"> 1642.61 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\"><span style=\"font-style: italic;\"><br></span></td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Table 1</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/table visualization_4afabcf7a0dd48de084c641dbdb2cfb7'}\n\n```{.r .cell-code}\nallTracts.Summary %>%\n  gather(Variable, Value, -year, -TOD) %>%\n  ggplot(aes(year, Value, fill = TOD)) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  facet_wrap(~Variable, scales = \"free\", ncol=5) +\n  scale_fill_manual(values = c(\"#bae4bc\", \"#0868ac\"),\n                    name = \"Type\") +\n  labs(title = \"Indicator differences across time and space\",\n       caption = 'Figure 2.7') +\n  plotTheme() + theme(legend.position=\"bottom\",)\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/table visualization-1.png){width=672}\n:::\n:::\n\n\n# TOD station surrounding analysis\n## station-centroid visualization\nBesides the analysis focusing on the tracts influenced by TOD, we also want to figure out the capability of different stations in gathering people and influencing social economic situation. Therefore, we select two indicators, including population and median rent price, to analyze the situation.\n\n### Population analysis\nTo get the influence based on station, we use spatial join to get the tracts that in each station, and then sum up the population based on the station's name. From the map, we can find that the station in the central part of DC gathered more people than the surrounding areas. The phenomenon could result from the gathering influence of transfer station in this region. What's more, the central part also had more increase in total population than surrounding areas.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/pop info in station_2883bd69690dcf50910b3573e4ca5594'}\n\n```{.r .cell-code}\nbuffer_new<- st_buffer(dc_station,2640)%>%\n  dplyr::select(NAME)\n\npop_area <- st_join(buffer_new,allTracts%>%select(TotalPop,year))\n\npop_area_sum <- pop_area%>%\n  group_by(NAME,year)%>%\n  summarise(pop = sum(TotalPop))%>%\n  st_drop_geometry()\n\nstation_new <- left_join(dc_station,pop_area_sum,by='NAME')\n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/graduated symbol maps of population_09c65b3b833efab7b44aaa1120e18158'}\n\n```{.r .cell-code}\n# population\nggplot() +\n  geom_sf(data = allTracts.group,fill='grey40') + \n  geom_sf(data = Tod_region, color = \"white\",fill=\"transparent\", size = 1)+\n    geom_sf(data = station_new,\n          pch = 21,\n          aes(size=pop),\n          fill=alpha('red',0.7),\n          col = 'grey20') +\n  labs(title = 'Population Graduated Symbol Maps in 2009 and 2019',\n       caption = 'Figure 3.1')+\n  facet_wrap(~year) +\n  scale_size(range = c(1,5))\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/graduated symbol maps of population-1.png){width=672}\n:::\n:::\n\n\n### Median Rent analysis\nHaving the similar data process step with population analysis one, we can find that the whole TOD region had an obvious median rent increase. When we look at the increase trend, we can find that the center to south-east TOD part have a higher median rent price increase compared to the north-west part, which may result from the the area's 2009 median rent price were on the high side for DC.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/rent info in station_ce14f628507c0c29c06c383b4eea95e8'}\n\n```{.r .cell-code}\nrent_area <- st_join(buffer_new,allTracts%>%select(MedRent,year))\nrent_area[is.na(rent_area)] <- 0\n\nrent_area_sum <- rent_area%>%\n  group_by(NAME,year)%>%\n  summarise(rent = mean(MedRent))%>%\n  st_drop_geometry()\n\nstation_new2 <- left_join(dc_station,rent_area_sum,by='NAME')\n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/graduated symbol maps of median rent_647c07ef3d74401306cdc115b22b71a7'}\n\n```{.r .cell-code}\n# rent\nggplot() +\n  geom_sf(data = allTracts.group,fill='grey40') + \n  geom_sf(data = Tod_region, color = \"white\",fill=\"transparent\", size = 1)+\n    geom_sf(data = station_new2,\n          pch = 21,\n          aes(size=rent),\n          fill=alpha('red',0.7),\n          col = 'grey20') +\n    labs(title = ' Median Rent Graduated Symbol Maps in 2009 and 2019',\n       caption = 'Figure 3.2')+\n  facet_wrap(~year) +\n  scale_size(range = c(1,5))\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/graduated symbol maps of median rent-1.png){width=672}\n:::\n:::\n\n\n## The analysis of the distance to TOD\nAfter the analysis for TOD radius areas, we try to make an analysis that if the distance from station have some continuous influence to social economic indicator. We make multi buffer based on the station, and then use the center point of tracts to represent the data in each tracts. Based on the points location relationship to the buffer rings, we label the distances information in each tracts dataset and make further analysis.  \n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/create multirings of tracts_f55cc1bc409f90b45a14c598a8b1d7c5'}\n\n```{.r .cell-code}\nstation_ring <- multipleRingBuffer(st_union(dc_station), 2640*9, 2640)\n\nallTracts.rings <-\n  st_join(st_centroid(dplyr::select(allTracts.group, GEOID, year)),\n          station_ring) %>%\n  st_drop_geometry() %>%\n  left_join(dplyr::select(allTracts.group, GEOID, MedRent, year), \n            by=c(\"GEOID\"=\"GEOID\", \"year\"=\"year\")) %>%\n  st_sf() %>%\n  mutate(distance = distance / 5280)\n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/visualize half mile buffers_e7990e2c5b1bb69263f6858ef7c18491'}\n\n```{.r .cell-code}\nggplot() +\n    geom_sf(data=station_ring,aes(color=distance)) +\n  scale_color_gradient()+\n    geom_sf(data=dc_station, size=1) +\n    geom_sf(data=st_union(allTracts.rings), fill=NA, color=\"red\",size=2) +\n    labs(title=\"Station Stops: Half Mile Buffers\",\n         subtitle = \"Washington DC\",\n         caption = \"Figure 3.3\") +\n    mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/visualize half mile buffers-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/Distance to stations_29c1a36bcf1b2cd7dc3271af5c48eec3'}\n\n```{.r .cell-code}\nggplot(allTracts.rings)+\n  geom_sf(data = st_union(tracts19))+\n  geom_sf(aes(fill = as.factor(distance)))+\n  geom_sf(data = Tod_region, color= \"#de660c\",fill=\"transparent\", size =9)+\n  scale_fill_brewer(palette = \"YlGnBu\",\n                      name = \"Distance to Subway Stations\")+\n  #distiller -> 用来做continuous palette, brewer->discrete \n    labs(title = \"Distance to Subway Stations by census tracts\",\n         subtitle = \"Washington DC\",\n       caption = \"Figure 3.4\")+\n  mapTheme()\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/Distance to stations-1.png){width=672}\n:::\n:::\n\nFrom the line chart of average median rent in different distances to station, we can find that the rent had a general increase from 2009 to 2019, which also show the same trend that the rent price gradually decrease when far from station at the beginning, and then increase to the peak when the distance comes to 2 to 2.5 miles. Due to the tract data which distance to TOD is 3.5 miles is Null and filled with 0 in data cleaning, we can still draw the conclusion from existing 2009 data that the rent will decrease again after 2.5 miles.\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/dataset of rent based on distance_dbcd3a2ef08e92110f6c908367859f4c'}\n\n```{.r .cell-code}\nallTracts.rings[is.na(allTracts.rings)] <- 0\nsummary <- allTracts.rings%>%\n  st_drop_geometry() %>%\n  group_by(year,distance)%>%\n  summarise(averagerent = mean(MedRent))\n```\n:::\n\n::: {.cell hash='MUSA508_Ass2_new_cache/html/rent-distance visualization_bded3acf12806b31fd003f5fdf2f3009'}\n\n```{.r .cell-code}\nggplot(data=summary,aes(x=distance, y=averagerent, group=year, color=year)) +\n    geom_line() +\n    ggtitle(\"Average rent in differnt distance to station\") +\n    ylab(\"Average rent\")\n```\n\n::: {.cell-output-display}\n![](MUSA508_Ass2_new_files/figure-html/rent-distance visualization-1.png){width=672}\n:::\n:::\n\n\n# Conclusion\nOverall, we can find that TOD region had a obvious and positive influence to the economic development in DC from 2009 to 2019. TOD region have more population, median rent price, and percentage of white increase in the decade，with better improvement of poverty. However, we should not forget the development may accompany with gentrification with higher living cost and segregation.\nWhat's more, the stations have better chance to serve more people in the decade with population increasing surrounding TOD region. With general rent price increase in TOD area, the center to south-east region experienced a higher increase. And the rent price associated with the station distance followed the regularity that decrease first, increase to the peak when the distance comes to 2.5 miles and then decrease gradully, which support the TOD's influence to DC.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}